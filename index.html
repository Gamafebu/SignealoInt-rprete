<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Intérprete LSM (móvil optimizado)</title>

  <style>
    /* ================================
       MOBILE-FIRST / RESPONSIVE STYLES
       ================================ */

    :root{
      --bg: #f4f6f9;
      --surface: #ffffff;
      --primary-a: #6a11cb;
      --primary-b: #2575fc;
      --text: #1f2937;
      --muted: #6b7280;
      --radius: 14px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      padding:18px;
      font-family: "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing:antialiased;
      -webkit-tap-highlight-color: transparent;
      line-height:1.35;
    }

    /* Cabecera */
    .title{
      text-align:center;
      font-size:1.5rem;
      font-weight:700;
      margin:4px 0 14px;
      color:var(--text);
    }

    /* Contenedor principal centrado y con anchura cómoda en móviles */
    .container{
      max-width:720px;
      margin:0 auto;
      width:100%;
      padding:0 6px;
    }

    .card{
      background:var(--surface);
      border-radius:18px;
      padding:14px;
      box-shadow: 0 6px 18px rgba(10,20,40,0.06);
      border: 1px solid rgba(15,23,42,0.04);
    }

    /* Vista previa: ocupa todo el ancho.
       En móvil quitamos bordes y se ve plano */
    .preview{
      width:100%;
      height:auto;
      display:block;
      border-radius:12px;
      object-fit:cover;
      background:#fff;
      margin-bottom:14px;
    }

    /* Quitamos bordes en pantallas pequeñas */
    @media (max-width: 480px) {
      .preview {
        border: none;
        box-shadow: none;
        border-radius: 8px;
        background: transparent;
      }
      .card {
        padding:12px;
        border-radius:12px;
        box-shadow: none;
        border: none;
      }
      body { padding:12px; }
      .title { font-size:1.3rem; margin-bottom:10px; }
    }

    /* Botones grandes y táctiles */
    .btn {
      display:block;
      width:100%;
      text-align:center;
      padding:14px 16px;
      font-size:1.05rem;
      border-radius:12px;
      border:none;
      cursor:pointer;
      font-weight:700;
      color:#fff;
      background: linear-gradient(135deg, var(--primary-a), var(--primary-b));
      transition: transform .12s ease, opacity .12s ease;
      margin-bottom:12px;
    }
    .btn:active { transform: translateY(2px); }
    .btn.secondary {
      background: #f3f4f6;
      color: var(--text);
      font-weight:600;
      box-shadow: 0 2px 0 rgba(0,0,0,0.03);
    }

    /* Input file con label estilizado (botón) */
    .file-wrapper {
      margin-top:12px;
    }
    .file-label {
      display:block;
      width:100%;
      padding:12px;
      border-radius:12px;
      text-align:center;
      cursor:pointer;
      font-weight:700;
      background: white;
      border: 2px dashed rgba(100,116,139,0.12);
      color: var(--text);
      box-shadow: 0 6px 14px rgba(17,24,39,0.04);
      margin-bottom:12px;
      transition: background .12s ease, border-color .12s ease;
    }
    .file-label:hover { background:#fbfdff; border-color: rgba(100,116,139,0.18); }

    /* ocultamos input real */
    #fileInput{ display:none; }

    /* Loading (centrado) */
    #loading {
      display:none;
      text-align:center;
      font-weight:700;
      color:var(--primary-b);
      padding:10px 6px;
      margin-top:6px;
    }

    /* Respuesta con enfoque visual */
    #response {
      margin-top:12px;
      padding:14px;
      background: linear-gradient(90deg, rgba(106,17,203,0.05), rgba(37,117,252,0.03));
      border-radius:12px;
      text-align:center;
      font-size:1.05rem;
      font-weight:700;
      color:var(--text);
      min-height:48px;
      display:flex;
      align-items:center;
      justify-content:center;
      word-break:break-word;
    }

    /* Espaciado extra para el selector (petición tuya) */
    .file-wrapper { margin-top:18px; margin-bottom:6px; }

    /* Pequeñas mejoras en tablet/desktop */
    @media (min-width: 720px) {
      .container { padding: 0 18px; }
      .card { padding: 22px; }
      .btn { width: 48%; display: inline-block; margin-right:4%; }
      .btn:last-child { margin-right:0; }
      .file-label { width: 60%; margin: 12px auto; }
    }

  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="title">Intérprete LSM</div>

      <!-- Previews -->
      <video id="preview" class="preview" autoplay playsinline style="display:none;"></video>
      <img id="imgPreview" class="preview" style="display:none;" alt="previsualización" />
      <video id="videoPreview" class="preview" controls style="display:none;"></video>
      <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

      <!-- Botones agrupados (en mobile aparecen apilados) -->
      <button id="startCamera" class="btn">Encender cámara</button>
      <button id="takePhoto" class="btn secondary">Tomar foto</button>

      <!-- Selector de archivo estilizado -->
      <div class="file-wrapper">
        <label for="fileInput" class="file-label">Seleccionar archivo</label>
        <input id="fileInput" type="file" accept="image/*,video/*">
      </div>

      <!-- Enviar -->
      <button id="sendToGemini" class="btn">Enviar</button>

      <div id="loading">Procesando...</div>

      <div id="response">Aquí aparecerá la respuesta</div>
    </div>
  </div>

  <script>
    // misma lógica JS, sin cambios funcionales
    let stream = null;
    let lastBase64 = null;
    let lastMime = null;

    const preview = document.getElementById("preview");
    const canvas = document.getElementById("canvas");
    const imgPreview = document.getElementById("imgPreview");
    const videoPreview = document.getElementById("videoPreview");
    const fileInput = document.getElementById("fileInput");
    const responseBox = document.getElementById("response");
    const loading = document.getElementById("loading");

    document.getElementById("startCamera").onclick = async () => {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        preview.srcObject = stream;
        preview.style.display = "block";
        imgPreview.style.display = "none";
        videoPreview.style.display = "none";
        lastBase64 = null;
      } catch (e) {
        alert("No se pudo acceder a la cámara");
      }
    };

    document.getElementById("takePhoto").onclick = () => {
      if (!stream) {
        alert("Primero enciende la cámara");
        return;
      }
      const ctx = canvas.getContext("2d");
      // dibujar a tamaño del canvas para mejor calidad
      const videoWidth = preview.videoWidth || preview.clientWidth;
      const videoHeight = preview.videoHeight || preview.clientHeight;
      canvas.width = Math.max(640, videoWidth);
      canvas.height = Math.max(480, videoHeight);
      ctx.drawImage(preview, 0, 0, canvas.width, canvas.height);
      lastBase64 = canvas.toDataURL("image/jpeg").split(",")[1];
      lastMime = "image/jpeg";
      responseBox.textContent = "Foto tomada";
    };

    fileInput.onchange = () => {
      const file = fileInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      lastMime = file.type;
      reader.onload = () => {
        lastBase64 = reader.result.split(",")[1];
        preview.style.display = "none";
        if (file.type.startsWith("image/")) {
          imgPreview.src = reader.result;
          imgPreview.style.display = "block";
          videoPreview.style.display = "none";
        } else {
          videoPreview.src = reader.result;
          videoPreview.style.display = "block";
          imgPreview.style.display = "none";
        }
        responseBox.textContent = "Archivo cargado";
      };
      reader.readAsDataURL(file);
    };

    document.getElementById("sendToGemini").onclick = async () => {
      if (!lastBase64) {
        alert("Primero toma una foto o sube un archivo");
        return;
      }
      const apiKey = prompt("Ingresa tu API KEY de Gemini:");
      if (!apiKey) return;

      const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + apiKey;

      const body = {
        contents: [
          {
            parts: [
              { text: "Interpreta la seña en LSM y responde de forma breve." },
              { inlineData: { mimeType: lastMime, data: lastBase64 } }
            ]
          }
        ]
      };

      loading.style.display = "block";
      responseBox.textContent = "";

      try {
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        const data = await res.json();
        loading.style.display = "none";
        const answer = data.candidates?.[0]?.content?.parts?.[0]?.text || "Sin respuesta";
        responseBox.textContent = answer;
      } catch (err) {
        loading.style.display = "none";
        alert("Error al conectar con Gemini");
      }
    };
  </script>
</body>
</html>
