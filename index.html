<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Intérprete LSM</title>

  <style>
    /* ================================
       ESTILO GENERAL Y RESPONSIVO
       ================================ */

    body {
      margin: 0;
      padding: 20px;
      font-family: "Segoe UI", sans-serif;
      background: #f4f6f9;
      color: #1f2937;
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
      font-size: 1.6rem;
      margin-bottom: 20px;
    }

    /* Contenedor principal */
    .container {
      max-width: 600px;
      margin: auto;
    }

    /* Vista previa de imagen/video */
    video, img, canvas {
      width: 100%;
      border-radius: 14px;
      display: block;
      margin: 15px 0;
      background: #ffffff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    /* Botones */
    button {
      width: 100%;
      padding: 14px;
      font-size: 1rem;
      margin-top: 12px;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    button:hover {
      opacity: 0.9;
    }

    /* Subir archivo - botón personalizado */
    .file-input-wrapper {
      margin-top: 22px;
      width: 100%;
    }

    .file-label {
      display: block;
      width: 100%;
      padding: 14px;
      background: #ffffff;
      border-radius: 14px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.08);
      text-align: center;
      font-weight: 600;
      cursor: pointer;
      border: 2px dashed #cbd5e1;
      transition: background 0.2s;
    }

    .file-label:hover {
      background: #f1f5f9;
    }

    #fileInput {
      display: none;
    }

    /* Loading */
    #loading {
      display: none;
      margin-top: 15px;
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: #2575fc;
    }

    /* Respuesta */
    #response {
      margin-top: 20px;
      background: white;
      padding: 15px;
      border-radius: 14px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      white-space: pre-wrap;
      min-height: 50px;
      font-size: 1.1rem;
    }

    /* Optimización para móviles */
    @media (max-width: 480px) {
      body {
        padding: 15px;
      }
      h1 {
        font-size: 1.4rem;
      }
    }
  </style>
</head>

<body>

  <div class="container">

    <h1>Intérprete LSM</h1>

    <!-- Vista previa cámara -->
    <video id="preview" autoplay playsinline style="display:none;"></video>

    <!-- Vista previa imagen -->
    <img id="imgPreview" style="display:none;" />

    <!-- Vista previa video -->
    <video id="videoPreview" controls style="display:none;"></video>

    <!-- Canvas interno -->
    <canvas id="canvas" width="360" height="260" style="display:none;"></canvas>

    <!-- Botones cámara -->
    <button id="startCamera">Encender cámara</button>
    <button id="takePhoto">Tomar foto</button>

    <!-- Subir archivo -->
    <div class="file-input-wrapper">
      <label for="fileInput" class="file-label">Seleccionar archivo</label>
      <input type="file" id="fileInput" accept="image/*,video/*">
    </div>

    <!-- Enviar -->
    <button id="sendToGemini">Enviar</button>

    <!-- Loading -->
    <div id="loading">Procesando...</div>

    <!-- Resultado -->
    <div id="response"></div>

  </div>

  <script>
    let stream = null;
    let lastBase64 = null;
    let lastMime = null;

    const preview = document.getElementById("preview");
    const canvas = document.getElementById("canvas");
    const imgPreview = document.getElementById("imgPreview");
    const videoPreview = document.getElementById("videoPreview");
    const fileInput = document.getElementById("fileInput");
    const responseBox = document.getElementById("response");
    const loading = document.getElementById("loading");

    // Encender cámara
    document.getElementById("startCamera").onclick = async () => {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        preview.srcObject = stream;

        preview.style.display = "block";
        imgPreview.style.display = "none";
        videoPreview.style.display = "none";
        lastBase64 = null;

      } catch (e) {
        alert("No se pudo acceder a la cámara");
      }
    };

    // Tomar foto
    document.getElementById("takePhoto").onclick = () => {
      if (!stream) {
        alert("Primero enciende la cámara");
        return;
      }

      const ctx = canvas.getContext("2d");
      ctx.drawImage(preview, 0, 0, canvas.width, canvas.height);

      lastBase64 = canvas.toDataURL("image/jpeg").split(",")[1];
      lastMime = "image/jpeg";

      alert("Foto tomada");
    };

    // Subir archivo
    fileInput.onchange = () => {
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      lastMime = file.type;

      reader.onload = () => {
        const base64 = reader.result.split(",")[1];
        lastBase64 = base64;

        preview.style.display = "none";

        if (file.type.startsWith("image/")) {
          imgPreview.src = reader.result;
          imgPreview.style.display = "block";
          videoPreview.style.display = "none";
        } else {
          videoPreview.src = reader.result;
          videoPreview.style.display = "block";
          imgPreview.style.display = "none";
        }
      };

      reader.readAsDataURL(file);
    };

    // Enviar a Gemini
    document.getElementById("sendToGemini").onclick = async () => {
      if (!lastBase64) {
        alert("Primero toma una foto o sube un archivo");
        return;
      }

      const apiKey = prompt("Ingresa tu API KEY de Gemini:");
      if (!apiKey) return;

      const url =
        "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key="
        + apiKey;

      const body = {
        contents: [
          {
            parts: [
              {
                text: "Interpreta el contenido visual como una seña de Lengua de Señas Mexicana. Responde de forma breve."+
                  "Tomate tu tiempo para pensar en la respuesta puedes compararlo con imagenes de internet"
              },
              {
                inlineData: { mimeType: lastMime, data: lastBase64 }
              }
            ]
          }
        ]
      };

      loading.style.display = "block";
      responseBox.textContent = "";

      try {
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        const data = await res.json();
        loading.style.display = "none";

        const answer =
          data.candidates?.[0]?.content?.parts?.[0]?.text ||
          "Sin respuesta";

        responseBox.textContent = answer;

      } catch (err) {
        loading.style.display = "none";
        alert("Error al conectar con Gemini");
      }
    };
  </script>

</body>
</html>
